{% load static %}
<!DOCTYPE html>
<html lang="en">


<!-- datatables.html  21 Nov 2019 03:55:21 GMT -->
<!-- Header Section -->
{% include "includes/head.html" %}
<!-- End Header Section -->

<body>
  <div class="loader"></div>


  
  <div id="app">
    <div class="main-wrapper main-wrapper-1">
      <div class="navbar-bg"></div>

           <!-- Nav Bar Section  -->
        {% include "includes/nav.html" %}
        <!-- End Nav Bar Section -->
        
        <!-- Side Bar Section -->
        {% include "includes/sidebar.html" %}        
        <!-- End Side Bar Section -->
      <!-- Main Content -->
      <div class="main-content">
        <section class="section">
          <div class="section-body">
            <div class="row">
              <div class="col-6">
                <div class="card">
                  <div class="card-header">
                      <h4>Scan Case One</h4>
                  </div>
                    <div class="card-body">
                        <div class="row">
                        <div class="col col-md-4">
                                <select class="form-select" id="company" name="company" aria-label="Select 2">
                                    <option selected disabled>Select Company</option>
                                    {% for company in companies %}
                                    <option value="{{company.id}}">{{company.owner}}</option>
                                    {% endfor %}
                                  </select>
                        </div>
                        <div class="col col-md-4">
                            <select class="form-select" name="network" id="network" aria-label="Select 2">
                                <option selected disabled>Select network</option>
                               
                              </select>
                        </div>
                        <div class="col col-md-4">
                            <select class="form-select"  id="scan_case1" name="scan_case" aria-label="Select 2">
                                {% for scan in scan_cases %}
                                <option selected value="{{scan.name}}">{{scan.name}} </option>
                                {% endfor %}
                              </select>
                        </div>
                        </div>
                        <div>
                          <div id="accordion">   
                          </div>
                        </div>
                     
                    </div>
                  </div>
                
           
              </div>
              <div class="col-6">
                <div class="card">
                    <div class="card-header">
                        <h4>Scan Case Two</h4>
                    </div>
                      <div class="card-body">
                        <div class="row">
                            <div class="col col-md-4">
  
                            <input type="text" class="form-control" id="compony_name" readonly placeholder="compony name" required> 
                            </div>
                            <div class="col col-md-4">
                               
                                
                                 <input type="text" class="form-control" id="ntwork" readonly placeholder="Network" required>
                               
                            </div>
                            <div class="col col-md-4">
                                <select class="form-select" id="scan_case2"  name="scan_case" aria-label="Select 2">
                                    <option selected disabled>Select Scan Case</option>
                                    {% for scan in scan_cases %}
                                    <option value="{{scan.scan_date}}">{{scan.name}}</option>
                                    {% endfor %}
                                  </select>
                            </div>
                            </div>
                            <div id="accordion2">   
                            </div>
                            
                      </div>
                    </div>
                  </div>
              </div>
              <div class="row">
                <div class="col-12">
                  <div class="card">
                      <div class="card-header">
                          <h4>Difference</h4>
                      </div>
                        <div class="card-body">
                              <div id="accordion2"> 
                                <div class="table-responsive">
                                  <table class="table table-striped table-hover" id="save-stage" style="width:100%;">
                                    <thead>
                                      <tr>
                                        <th>#</th>
                                        <th>Name</th>
                                        <th>Date</th>
                                        <th>Action</th>
                                      </tr>
                                    </thead>
                                    <tbody>
                                      <tr>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td>                                           
                                        </td>                                  
                                      </tr>
                                    <tbody>
                                    
                                 
                                  </table>
                                </div>
              
                              </div>
                              
                        </div>
                      </div>
                    </div>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- Setting Bar Sections -->
        {% include "includes/settingbar.html" %}        
        <!-- Ending Setting Bar Sections -->

      </div>

      <!-- Footbar Section -->
      {% include "includes/footer.html" %}
      <!-- EndFootbar Section -->

    </div>
  </div>

  <!-- General JS Scripts -->

  <!-- Scripts Section -->
  {% include "includes/scripts.html" %}
  
  <script src="{% static 'assets/scripts/pages/company.js' %}"></script>
  <script>
    $(document).ready(function(){
      $('#company').on('change',function(){
        event.preventDefault();
        var campany_name = $(this).val();
        var t = $('#company option:selected').text();
        console.log(t);
        $("#compony_name").val(t);
       $.ajax({
        type:'GET',
        url: '/get_campany_name/',
        data:{
          'name': campany_name
        },
          success : function(data){
            // console.log(data);
           var network_dr = $('#network').empty()
           network_dr.empty()
          
            $.each(data, function(index, element) {
              const option = document.createElement("option");
              option.text = element.network;
              option.value = element.id
              $('#ntwork').val(element.network)
              network_dr.append(option);
              console.log(element.network);
            
    });
          }
       })
       

      });

      $('#network').on("change", function(){
        var text = $('#network option:selected').text();
        $('#ntwork').val(text)
        console.log(text);

      })

      send_comper_request()
      send_comper2_request()
      
   
    })
    function send_comper_request(){
  
      $('#scan_case1').on('change',function(){     
      event.preventDefault();
      var filterDate = $(this).val();
      var date = new Date(filterDate);
      var network = $('#network').val();
      var year = date.getFullYear().toString();
      var month = ('0' + (date.getMonth() + 1)).slice(-2);
      var day = ('0' + date.getDate()).slice(-2);
      var formattedDate = year + '-' + month + '-' + day;
      $('#accordion').empty()
      console.log(formattedDate);
      $.ajax({
        type:'GET',
        url:'/compare_by_date/',
        data:{
          'FILTERED_DATE': formattedDate,
          'network': network,
         
      },
        success: function(data) {

          $('#accordion').append(" Total Networks ", data.all_networks, " | ","Total Ports : ",data.all_ports, " | "," Total Hosts ", data.all_hosts);
        }

      })

      });


}  
    function send_comper2_request(){

      $('#scan_case2').on('change',function(){     
      event.preventDefault();
      var filterDate = $(this).val();
      var date = new Date(filterDate);
      var network = $('#network').val();
      var year = date.getFullYear().toString();
      var month = ('0' + (date.getMonth() + 1)).slice(-2);
      var day = ('0' + date.getDate()).slice(-2);
      var formattedDate = year + '-' + month + '-' + day;
      $('#accordion2').empty()
      console.log(formattedDate);
      $.ajax({
        type:'GET',
        url:'/compare_by_date/',
        data:{
          'FILTERED_DATE2': formattedDate,
          'network': network,
          
      },
        success: function(data) {
          $('#accordion2').append(" Total Networks ", data.all_networks2, " | ","Total Ports : ",data.all_ports2, " | "," Total Hosts ", data.all_hosts2, data.diference);
        }
      })
      });
    }

  </script>
  <!-- End Scripts Section -->
</body>
<!-- datatables.html  21 Nov 2019 03:55:25 GMT -->
</html>